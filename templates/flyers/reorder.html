{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Reorder Flyers" %}{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">{% trans "Reorder Flyers" %}</h2>
    <a href="{% url 'portal:flyer_list' %}" class="btn btn-secondary">{% trans "Back to list" %}</a>
  </div>

  <p class="text-muted">{% trans "Drag items to change their order. Click Save when done." %}</p>

  <ul id="flyers-list" class="list-group">
    {% for flyer in flyers %}
      <li class="list-group-item d-flex align-items-center gap-3" data-id="{{ flyer.id }}">
        <span class="handle" title="{% trans 'Drag' %}" style="cursor:grab;">↕</span>

        {% if flyer.image %}
          <img
            src="{{ flyer.image.url }}"
            alt=""
            style="height:48px;width:auto;border-radius:4px;"
          >
        {% else %}
          <span class="text-muted">—</span>
        {% endif %}

        <div class="flex-grow-1">
          <div class="fw-bold">{{ flyer.title_en|default:flyer.title_it }}</div>
          {% if flyer.event_date %}
            <div class="text-muted small">{{ flyer.event_date|date:"Y-m-d" }}</div>
          {% endif %}
        </div>

        <span class="badge bg-light text-dark border order-index">{{ forloop.counter }}</span>
      </li>
    {% empty %}
      <li class="list-group-item text-muted">{% trans "No flyers to reorder." %}</li>
    {% endfor %}
  </ul>

  <form id="save-order-form" method="post" class="mt-3" action="{% url 'portal:flyers_reorder' %}">
    {% csrf_token %}
    <input type="hidden" name="order" id="order-input">
    <button type="submit" class="btn btn-primary">{% trans "Save Order" %}</button>
    <a href="{% url 'portal:flyer_list' %}" class="btn btn-outline-secondary ms-2">{% trans "Cancel" %}</a>
  </form>

  <div id="save-alert" class="alert alert-success mt-3 d-none" role="alert">
    {% trans "Order saved." %}
  </div>
</div>

{# ---- Lightweight drag & drop + POST (no /media/ anywhere) ---- #}
<script src="https://unpkg.com/sortablejs@1.15.2/Sortable.min.js" crossorigin="anonymous"></script>
<script src="{% static 'js/reorder.js' %}"></script>
{% endblock %}
